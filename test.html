<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Read and Write Google Sheet Data</title>
</head>
<body>
  <h2>Read Google Sheet Data:</h2>
  <div id="readResult"></div>
  <button onclick="readData()">Read Data</button>

  <h2>Write Google Sheet Data:</h2>
  <input type="text" id="writeInput" placeholder="Enter data to write">
  <button onclick="authenticate()">Write Data</button>

  <script>
    
    const apiUrl = 'https://sheets.googleapis.com/v4/spreadsheets/';

    // const sheetId = '19nXrhuBKJhyLMBjcsy8ctPXeso0yZ3RNeRpJ8GMz1bs';  //SpreadsheetApp.getActiveSpreadsheet().getId();
    const sheetId = '1aT0ytPE0Zt-sBkT691_4muq7i5I1HNF0QpAnJkFA__A';  //SpreadsheetApp.getActiveSpreadsheet().getId();

    const clientId = '526082832932-ddtah9a5gcsv3ket41hbeb3nmd1eeamj.apps.googleusercontent.com';

    // const apiKey = 'AIzaSyCeCvhUUS-Sxryx363mNu-RYlfiDNFJd5o'; //https://console.cloud.google.com/
    const apiKey = 'AIzaSyCEZGoMWDttmhiobVX687Sw2VuM_DzShw0'; //https://console.cloud.google.com/

    const scope = 'https://www.googleapis.com/auth/spreadsheets';

    
    function authenticate() {
      gapi.auth.authorize({
        'client_id': clientId,
        'scope': scope,
        'immediate': false
      }, handleAuthResult);
    }

    
    function handleAuthResult(authResult) {
      if (authResult && !authResult.error) {
        writeData(authResult);
      } else {
        console.error('Authorization failed:', authResult.error);
      }
    }

    
    function writeData(authResult) {
      const inputData = document.getElementById('writeInput').value;
      const accessToken = authResult.access_token;
      fetch(`${apiUrl}${sheetId}/values/Sheet1!A1:A1:append?valueInputOption=USER_ENTERED&access_token=${accessToken}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          values: [[inputData]]
        })
      })
      .then(response => response.json())
      .then(data => {
        console.log('Data written successfully:', data);
      })
      .catch(error => {
        console.error('Error writing data:', error);
      });
    }
   
    function readData() {
      fetch(`${apiUrl}${sheetId}/values/Sheet1?key=${apiKey}`)
        .then(response => response.json())
        .then(data => {
          const values = data.values;
          const resultDiv = document.getElementById('readResult');
          resultDiv.innerHTML = ''; 
          if (values && values.length > 0) {
            const table = document.createElement('table');
            values.forEach(row => {
              const tr = document.createElement('tr');
              row.forEach(cell => {
                const td = document.createElement('td');
                td.textContent = cell;
                tr.appendChild(td);
              });
              table.appendChild(tr);
            });
            resultDiv.appendChild(table);
          } else {
            resultDiv.textContent = 'No data found';
          }
        })
        .catch(error => {
          console.error('Error fetching data:', error);
          const resultDiv = document.getElementById('readResult');
          resultDiv.textContent = 'Error: ' + error.message;
        });
    }
  </script>
  <script src="https://apis.google.com/js/client.js"></script>
</body>
</html>
